<!DOCTYPE html>
<html>
<head>
    <title>LegoProxy Dashboard</title>
    <link rel="stylesheet" type="text/css" href="static/style.css">
</head>
<style>

</style>
<body>
    <div style="margin-top: 50px; margin-left: auto; margin-right: auto; width: 70%;">
		<div class="container" style="display: grid; grid-template-columns: 1fr 1fr;">
			<text style="font-size: 50px;"><text style="font-size: 50px; color: #75b2eb;">Lego</text><text style="font-size: 50px; color: #87d997;">Proxy</text> Dashboard</text>
			<button type="red" style="height: 50px; width: 150px; margin-right: 0; margin-left: auto;" onclick="location.href='/logout'">Log Out</button>
		</div>
		
		<div class="container" style="margin-top: 30px; display: grid; grid-template-columns: 1fr 1fr; gap: 20px 20px;">
			<div class="container">
				<text style="font-size: 30px;">Proxy Configuration</text><br><br>
				<input type="number" id="placeId" name="placeId" style="border-radius: 5px; height: 25px; width: 100%;" placeholder="Roblox Place ID"></input><br><br>
				<input type="number" id="cacheExpiry" name="cacheExpiry" style="border-radius: 5px; height: 25px; width: 100%;" placeholder="Cache Expiry (seconds)"></input><br><br>
				<input type="text" id="proxyAuth" name="proxyAuth" style="border-radius: 5px; height: 25px; width: 100%;" placeholder="Proxy Authentication Key"></input><br><br>
				<button type="green" id="save" style="height: 45px; width: 100%;" onclick="saveConfiguration()">Save Changes</button><br><br>
			</div>
		</div>
	</div>

	<script>
		function saveConfiguration() {
		 	const placeId = document.getElementById('placeId').value;
		 	const proxyAuth = document.getElementById('proxyAuth').value;
		 	const cacheExpiry = document.getElementById('cacheExpiry').value;
			
		 	fetch('/saveconf', {
		 	 	method: 'POST',
		 	 	headers: {
		 	 	  'Content-Type': 'application/json'
		 	 	},
		 	 	body: JSON.stringify({
					placeId: Number(placeId),
					proxyAuthKey: proxyAuth,
					cacheExpiry: Number(cacheExpiry)
					})
		 	})
		 	.then(response => response.json())
		 	.then(data => console.log(data))
		 	.catch(error => console.error(error));
		}

		function getCookie(name) {
		  	var value = "; " + document.cookie;
		  	var parts = value.split("; " + name + "=");
		  	if (parts.length == 2) return parts.pop().split(";").shift();
		}

		window.onload = function(){
			fetch("/getconf")
    		.then(response => response.json())
    		.then(data => {
    			document.getElementById("placeId").value = data.placeId;
    			document.getElementById("cacheExpiry").value = data.cacheExpiry;

				if (document.getElementById("proxyAuth").value === undefined || document.getElementById("proxyAuth").value === null) {
					document.getElementById("proxyAuth").value = "";
				}
    		})
    		.catch(error => console.error(error));
		}

	</script>

</body>
</html>
